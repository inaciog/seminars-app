<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seminars App</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
    }
    #root {
      padding: 20px;
    }
    .card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 { color: #333; margin-bottom: 16px; }
    .btn {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }
    .btn:hover { background: #2563eb; }
    .loading { text-align: center; padding: 40px; }
    .error { color: #dc2626; padding: 20px; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script>
    // Polyfills for older browsers
    if (!Array.prototype.flat) {
      Array.prototype.flat = function(depth) {
        var flattened = [];
        (function flat(array, depth) {
          for (var i = 0; i < array.length; i++) {
            if (Array.isArray(array[i]) && depth > 0) {
              flat(array[i], depth - 1);
            } else {
              flattened.push(array[i]);
            }
          }
        })(this, Math.floor(depth) || 1);
        return flattened;
      };
    }
    
    // Simple app without React
    (function() {
      'use strict';
      
      var root = document.getElementById('root');
      
      function getToken() {
        try {
          var params = new URLSearchParams(window.location.search);
          var urlToken = params.get('token');
          if (urlToken) {
            localStorage.setItem('seminars_token', urlToken);
            window.history.replaceState({}, '', window.location.pathname);
            return urlToken;
          }
          return localStorage.getItem('seminars_token');
        } catch (e) {
          console.error('Error getting token:', e);
          return null;
        }
      }
      
      function renderLoading() {
        root.innerHTML = '<div class="loading">Loading...</div>';
      }
      
      function renderLogin() {
        var currentUrl = window.location.href;
        var authUrl = 'https://inacio-auth.fly.dev/login?returnTo=' + encodeURIComponent(currentUrl);
        root.innerHTML = '<div class="loading">Redirecting to login...</div>';
        window.location.href = authUrl;
      }
      
      function renderApp() {
        root.innerHTML = 
          '<div class="card">' +
            '<h1>ðŸ“š Seminars App</h1>' +
            '<p>Welcome! The app is working.</p>' +
            '<button class="btn" onclick="alert(\'Button works!\')">Test Button</button>' +
          '</div>';
      }
      
      function renderError(msg) {
        root.innerHTML = '<div class="card error">Error: ' + msg + '</div>';
      }
      
      // Main
      try {
        renderLoading();
        var token = getToken();
        
        if (!token) {
          renderLogin();
        } else {
          renderApp();
        }
      } catch (e) {
        renderError(e.message);
      }
    })();
  </script>
</body>
</html>
